{"1000":{"id":1000,"title":"你离开了北京，从此只剩春秋冬","author":"庄天宇","timestamp":1555068480000,"markdownString":"### 你离开了北京，从此只剩春秋冬\n\n庄天宇 2019-04-12\n\n今天是3月20日，我正在去地铁站的车上，夏是我的朋友，他将在四月份离开北京，回南昌工作。我想，他离开当天，我会发一条朋友圈，把这篇文章链过去。\n\n#### 从前共你，促膝把酒倾通宵都不够\n\n我和夏认识不到一年，工作认识的。他比我晚入职一周，就在我旁边的工位，当时就是夏天。\n\n早上在食堂遇到，夏穿了件库里的T恤，吃着食堂的煎饺津津有味。我也是满头大汗，刚从西二旗地铁站骑车过来，端着早饭坐下。聊火箭会不会在季后赛遇到勇士，聊彼此。\n\n后来西部半决赛，火箭被勇士淘汰出局。我侧头对夏说了句\"舒服了\"，心里却不是滋味。那个赛季是火箭希望很大的赛季，最后还是被宇宙勇淘汰，下个赛季是未知的，那时候我还不知道新赛季哈登拿了得分王又很接近二连MVP。\n\n我是有些可惜，但对夏，对勇士的祝福是真的。学生时代就羡慕勒布朗的球迷，羡慕库里的球迷，有他们在仿佛就有了季后赛甚至总决赛的门票。但是这并不影响我们埋汰彼此喜欢的球员，甚至我会说哈登只会骗犯规，夏也说库里就会投三分不会别的，于是我们约了周六去华电打球，就在夏他家旁边：\n\n- 明天中午来我家吧，我给你做煎饺吃。\n- 这么牛逼呢？\n- 点外卖啊，小恒水饺，刚好送到就凉了，再煎一下。你吃啥馅儿的？\n\n饭后走到球场，华电球场那儿的水吧是自助的，拿几瓶水看看价目表多少钱，自己扫码付款就行。\n\n我拎了三大瓶脉动，扫码付款，听到夏说他来他来，我想着几瓶水谁买都一样，和夏同一时间付了款。两人大眼瞪小眼，付了双份的钱，只能又拿了三瓶大脉动。那天下午不记得球打得怎么样了，反正饮料是真的喝不完。\n\n晚上九点，明早提测，我们都依旧有一些已知的bug没有修复。正写着，夏扭头问了句：\n\n- 你这里是什么逻辑？\n- 你在改我的bug吗，这模块有点儿复杂，我之后自己改吧。\n\n继续写代码，过了会儿：\n\n- 我改好了，你还有哪儿没改的？\n\n事后我好多次提到帮我改bug这件事：\n\n- 你的bug太多了，我想着早点改完上线，我早点回家。\n\n夏是真的喜欢麦旋风，我也真的喜欢麦辣鸡腿堡。麦当劳真是个好地方，春节期间还出了杨超越封面的小食桶，里面有麦辣鸡翅、椒盐鸡翅和薯格。\n\n我们在周五晚上的西二旗的麦当劳畅谈工作生活，享受没有外面冬天冷的麦旋风。\n\n我们在春节放假后的下午，拖着行李箱在麦当劳聊新年计划。\n\n甚至在去吃火锅的路上也要在路过的麦当劳买两杯麦旋风吃。\n\n当然肯德基也会吃，那天我们买了冰淇淋吃，夏的草莓圣代，我的榴莲甜筒。我看着夏圣代上面满满的草莓酱：\n\n- 你那个酱，给我挖一勺。\n- 你可真不要脸。\n\n后来的一天早上，我买了肉酱+西红柿鸡蛋的河粉打包到工位吃。此时夏正在喝小米粥吃鸡蛋，冲我来了句：\n\n- 把你的肉酱给我挖一勺。\n\n我忽然反应过来，mmp！\n\n再后来的一天下午，和朋友们唱歌从KTV出来，去吃烧烤的路上。我和夏走在后面聊天，夏突然冒出一句：\n\n- 我有故事，你有北冰洋吗？\n\n#### 要走一刻，请不必诸多眷恋\n\n傍晚从公司骑车，我们去西三旗找杨明宇吃饭。路过后厂村路，跨过G6辅路，等了一个红绿灯，骑在建材城西路上。仿佛时间还在去年夏天，却不经意间已经过了一年。\n\n我和夏在夏天认识，也在夏天告别。\n\n李志有一首歌，\"你离开了南京，从此没有人和我说话\"。\n\n我想，夏离开了北京，北京从此只剩春秋冬了。\n\n#### 后记：\n\n我们生来就是孤独，\n\n我们生来就是孤单，\n\n不管你拥有什么，\n\n我们生来就是孤独。\n\n--来自李志的单曲《梵高先生》"},"1001":{"id":1001,"title":"如果想念有翅膀，它一定会飞","author":"庄天宇","timestamp":1570721940000,"markdownString":"### 如果想念有翅膀，它一定会飞\n\n庄天宇 2019-10-10\n\n如果想念有翅膀，\n\n它一定会飞到我成长的镇子上，那条胡同里平房的炉子旁。\n\n也或许会飘到我生活过的城市，冬天结满冰的马路上。\n\n也许在人们早起为上学的孩子做饭的清晨，\n\n也许在守着工作一天的人终于回到家的深夜，\n\n也许在这片想念漂浮在空中的某一个时刻。\n\n我还可以回到镇子的平房里，\n\n我也可以回到城市的马路上，\n\n可无论在哪里，这片想念只能飞，只能飞。\n\n我捉不到。\n\n我会在梦里梦到你，隔着公交车的车窗，隔着冬天的凉。"},"1002":{"id":1002,"title":"React Hooks: 使用 useEffect 调整页面布局","author":"庄天宇","timestamp":1579970924454,"markdownString":"## React Hooks: 使用 useEffect 调整页面布局\n\n庄天宇 2020-01-26\n\n### 背景\n\n本项目期望兼容<code>PC/移动端</code>，通过<code>百分比布局 + max-width</code>实现。\n\n常规页面为了保证 pc 端的体验，设置了<code>max-width: 800px</code>.\n\n(避免屏幕过大 => 扭的脖子疼 😑)\n\n如下：\n\n![](https://zhuangtianyu.com/image/1580018232368.png)\n\n项目中有如下的<code>编辑</code>页面，用于<code>增加/编辑</code>文章：\n\n![](https://zhuangtianyu.com/image/1580018279395.png)\n\n考虑<code>编辑</code>页面需要在编写<code>markdown</code>的同时，提供右侧的实时预览，所以将容器设置为<code>max-width: none</code>. 最大化地保证编写体验。\n\n> <code>max-width: none</code>--元素未设置最大值，即全屏布局。\n\n于是在该页面的<code>index.scss</code>文件配置了<code>max-width: none</code>.\n\n随后问题来了，因为我在项目中手动实现了<code>css namespace</code>\n\n(纯粹是因为觉得没有必要在 css 环节安装其它依赖)\n\n所以对于通用容器样式的修改是全局的，<code>.container</code>即使在离开该页面后，依然保持<code>max-width: none</code>最大化宽度。\n\n虽然可以通过刷新页面的方式来解决，但那也太low了…\n\n### 解决方案\n\n想到之前看 react hooks 的文档时，<code>useEffect</code>钩子的说明：\n\n> Effect Hook 可以让你在函数组件中执行副作用操作，每个 effect 都可以返回一个清除函数。React 会在组件卸载的时候执行清除操作。\n\n最终代码实现如下：\n\n```\n  useEffect(() => {\n    const nodeList = Array.from(document.querySelectorAll('.container'))\n\n    nodeList.forEach(node => {\n      const { maxWidth } = node.style\n      Object.assign(node, { maxWidth })\n      Object.assign(node.style, { maxWidth: 'none' })\n    })\n\n    return () => {\n      nodeList.forEach(node => {\n        const { maxWidth } = node\n        Object.assign(node.style, { maxWidth })\n      })\n    }\n  }, [])\n```\n\n逻辑如下:\n\n- 组件初始化时，遍历页面上的<code>.container</code>容器。\n- 记录原始<code>max-width</code>，修改当前样式为<code>max-width: none</code>.\n- 组件卸载时，根据之前记录的<code>max-width</code>值，进行还原操作。"},"1003":{"id":1003,"title":"使用 nginx 与 nodejs 搭建图片服务器","author":"庄天宇","timestamp":1580022865857,"markdownString":"## 使用 nginx 与 nodejs 搭建图片服务器\n\n庄天宇 2020-01-26\n\n### 需求背景\n\n期望在本项目的 markdown 文档预览中，引入图片资源，以优化阅读体验。\n\n所以需要一个图片服务器，来保存编辑文档时的图片文件。\n\n昨天异想天开，想着平日里自己使用<code>有道云笔记</code>比较多，\n\n那么为何不把图片上传到<code>有道云笔记</code>上面，然后引用<code>图片链接地址</code>来使用图片呢？\n\n这不就相当于把<code>有道云笔记</code>当作自己的图片服务器 === 白嫖。\n\n尝试之后发现，在开发环境与pc端的线上环境，都可以在文档发布后，正常加载图片。\n\n但是在手机端，图片无法正常被引用。随后定位到原因：\n\n- 开发环境与pc端的线上环境，所处的浏览器都登录了<code>有道云笔记</code>的账号，在登录状态下是可以加载<code>有道云笔记</code>域名下的资源的。\n- 手机端因为没有登录过<code>有道云笔记</code>，或许是因为跨域的原因，一直无法获取到图片的资源。\n\n如果把图片放在前端/后端的项目里，每次提交文档都要发版，就很麻烦。\n\n如果图片托管到比如<code>七牛云</code>这样的资源平台，不但要花钱，重要的是还要花费<code>时间成本/学习成本</code>去新建账号等一系列繁琐的配置工作。\n\n那么，不如自己搭建一个图片服务器好了。\n\n### 解决方案\n\n#### 1.更新 nginx 服务配置文件\n\n文件存放路径如下: <code>/root/webserver/nginx/conf/nginx.conf</code> (可根据自己的服务器自行配置)\n\n添加如下配置，将主域名下的<code>/image/</code>路由，映射到<code>/root/image/</code>目录下：\n\n```\nlocation /image/ {\n  root  /root/;\n  autoindex on;\n}\n```\n随后重启 nginx 服务: <code>systemctl restart nginx.service</code>\n\n可以通过<code>scp</code>脚本，或<code>ftp</code>工具，上传图片文件到指定目录，\n\n通过访问<code>http://xxx.com/image/some-file.png</code>来验证是否配置成功。\n\n#### 2.nodejs 支持图片上传服务\n\n本项目使用<code>koa</code>支持后台系统，需要在项目中引入<code>koa-body</code>依赖，并提供文件上传服务：\n\n#####  iTerm2：\n\n```\nyarn add koa-body\n```\n\n\n##### nodeJs：\n\n```\nconst koaBody = require('koa-body')\n\n...\n\n// 文件上传服务\nrouter.post('/xxx/upload', (ctx, next) => {\n  const file = ctx.request.files.file\n  const reader = fs.createReadStream(file.path);\n  const fileName = `${new Date().valueOf()}.${file.name.split('.')[1]}`\n  const stream = fs.createWriteStream(`../image/${fileName}`)\n  reader.pipe(stream)\n\n  ctx.body = {\n    status: true,\n    data: { src: `http://xxx.com/image/${fileName}` },\n    message: '请求成功'\n  }\n})\n\n...\n\napp.use(koaBody({ multipart: true }))\n```\n\n#### 注意\n\n之前为了解析<code>post</code>请求的参数，引入了<code>koa-bodyparser</code>.\n\n本次引入<code>koa-body</code>后，发现二者并不兼容。\n\n可以移除<code>koa-bodyparser</code>，解析<code>post</code>请求参数的需求由<code>koa-body</code>支持。\n\n```\nyarn remove koa-bodyparser\n```\n\n#### 3.前端页面开发\n\n本项目引入了<code>ant design</code>，可以直接使用其<code>Upload</code>组件，无需自己封装上传工具。\n\n通过<code>Upload</code>组件，调用在步骤2中提供的<code>文件上传服务</code>，可以获得文件在服务器端的保存地址。\n\n随后在编辑文档时，通过<code>markdown</code>的<code>![]('http://xxx.com/image/some-file.png')</code>语法即可插入图片。\n\n"},"1004":{"id":1004,"title":"春节期间网站更新日志，及开发体验","author":"庄天宇","timestamp":1580097324879,"markdownString":"## 春节期间网站更新日志，及开发体验\n\n庄天宇 2020-01-27\n\n### 上一个版本 (2019)\n\n2019 年春节，发布了网站的第一个版本，可以说做的稀烂。\n\n烂到什么程度呢，在地址栏输入一个错误的文档 id，nodejs 服务就会崩了。\n\n已发布的文章也没有支持再次编辑，想改只能去服务器 vim，或者在本地拉取文件修改后，再重新发版。\n\n更不用说 ui 设计、交互体验这些细节了。\n\n 2019 年 10 月，我停掉了网站。\n\n### 当前版本 (2020)\n\n2019 年 9 月，开始使用 react-hooks.\n\n2019 年 11 月，双 11 期间收到阿里云服务器的续费推送。\n\n2020 年 1 月底，决定背着电脑回家，春节后发布一版新的网站。\n\n制定了如下方案：\n\n- 除夕：确定技术栈 &&  项目构建 ✅\n- 初一：图片上传 && 资源服务器构建 ✅\n- 初二：markdown 编辑器开发 ✅\n- 初三：全局音乐播放器开发 ❌\n- 初四：细节优化 && 自测 ✅\n- 初五：回北京 ❓\n\n目前来看，除了【音乐播放器】没开发外，就剩【回北京】没有落实了。\n\n### 开发体验\n\n春节期间，感觉代码效率和质量都有了很大的提升：\n\n- 不用处理繁杂混乱的业务线，不用每天多个项目来回切换。\n- 自己设计项目流程、交互方式、迭代计划。虽然有些忙，但井井有条。\n- 自己开发接口并制定规范，终于不用处理接口返回<code>{ data: null }</code>这类的异常。\n- 需要配合的环节都自己实现，或引入现有的轮子，不依赖于其他环节。\n\n如果不是为了生活，我就想这样写下去。"},"1005":{"id":1005,"title":"关于本站前后端技术解决方案","author":"庄天宇","timestamp":1580098216395,"markdownString":"## 关于本站前后端技术解决方案\n\n庄天宇 2020-01-27\n\n项目地址：\n\n- 前端：<a href=\"https://github.com/zhuangTianYu/luck-2020-react\" target=\"_blank\">https://github.com/zhuangTianYu/luck-2020-react</a>\n\n- 后端：<a href=\"https://github.com/zhuangTianYu/node-service/tree/luck-2020-service\" target=\"_blank\">https://github.com/zhuangTianYu/node-service/tree/luck-2020-service</a>\n\n### 一、前端项目架构\n\n#### 1.前端项目构建\n\n使用<code>react</code>官方脚手架<code>create-react-app</code>构建项目。\n\n> <a href=\"https://reactjs.org/docs/create-a-new-react-app.html\" target=\"_blank\">https://reactjs.org/docs/create-a-new-react-app.html</a>\n\n通过<code>百分比布局 + max-width</code>兼容<code>pc/移动</code>双端。\n\n引入了<code>antd</code>，将工作重点转移到核心功能。\n\n> <a href=\"https://ant.design/\" target=\"_blank\">https://ant.design/</a>\n\n#### 2.前端项目路由设计\n\n- intro 页面：静态页面，装逼用的。\n\n- home 页面：项目主页面\n\n    - article 页面：文档主页面\n\n        - list 页面：文档列表页\n\n        - detail 页面：文档详情页\n\n        - edit 页面：文档新增/编辑页\n\n    - resume 页面：关于作者页面\n\n#### 3.前端技术支持\n\n- axios：<a href=\"https://github.com/axios/axios\" target=\"_blank\">https://github.com/axios/axios</a> --网络请求\n\n- showdown：<a href=\"https://github.com/showdownjs/showdown\" target=\"_blank\">https://github.com/showdownjs/showdown</a> --markdown to html\n\n### 二、后端技术架构\n\n#### 1.后端项目构建\n\n使用了基于<code>nodejs</code>的<code>koa2</code>框架。\n\n> <a href=\"https://koajs.com/\" target=\"_blank\">https://koajs.com/</a>\n\n#### 2.后端项目设计\n\n总体功能可以拆分为文档模块 (article) 的增删改查。\n\n对于文档列表、详情的读取操作，无需进行身份验证。\n\n对于文档新增、编辑的读写操作，需要进行身份验证 (只有我可以 😎)。\n\n所以通过 <code>.json</code>文件存储文章数据，通过配置文件存储身份验证密码。\n\n<code>.json</code>文件以<code>id</code>为主键，数据结构如下：\n\n```\n{\n  \"1000\": {\n    \"id\": 1000,\n    \"title\": \"title string\",\n    \"author\": \"author string\",\n    \"timestamp\": 1579964175404,\n    \"markdownString\": \"### markdown string\"\n  }\n}\n```\n\n通过<code>fs</code>模块读取<code>.json</code>文件，并进行更新 ⬇️\n\n#### 3.后端项目接口\n\n\n1. 编辑权限校验\n\n```\n提交的密码 === 配置文件的密码 ?\n```\n\n2. 文档列表\n\n```\n() => Object.keys(articleMap).map(id => articleMap[id])\n```\n\n\n3. 文档详情\n\n```\nid => articleMap[id]\n```\n\n4. 文档新增\n\n```\narticle => Object.assign(articleMap, { [id]: article })\n```\n\n\n5. 文档修改\n\n```\narticle => Object.assign(articleMap[id], article)\n```"},"1006":{"id":1006,"title":"7号傍晚🌆，听起来就很美妙","author":"庄天宇","timestamp":1580477185311,"markdownString":"### 7号傍晚🌆，听起来就很美妙\n\n庄天宇 2020-01-31\n\n#### 新型冠状病毒 (2019-nCoV)\n\n朋友问我什么时候回北京，我说“7号傍晚”。\n\n刚好输入“傍晚”时，输入法联想了 emoji 的表情：\n\n![](https://zhuangtianyu.com/image/1580491891076.png)\n\n意境一下子就来了。\n\n仿佛天忽然晚了下来。\n\n因工作扰乱的春节已经被甩到了三万里外的高空，用雾霾隔绝。\n\n7号的傍晚是属于我自己的。\n\n因为不合理的“规则”，我可能无法回到住处。\n\n但可以找个宾馆扔下包，戴上口罩寻找附近有围栏的河。\n\n从大兴机场到天通苑的距离竟然有 40km.\n\n但能从大兴的始发站，一直坐到地铁5号线的最北边，也不错。\n\n(正文结束)\n\n#### 感想\n\n这篇文章提交于 2020-01-31 晚 9 点，起初觉得这篇因为输入法提示而一时兴起的文章，会占据很大篇幅。\n\n直到写了一部分才发现，自己想说的其实没有那么多，更多的是想记录一下那刻的心情。\n\n其他时间里，我一直在找关于【北京，傍晚，河，桥】主题的照片，因为觉得在某个孤独的傍晚走在河边很有氛围。\n\n于是我把必应、谷歌、百度的搜索结果翻了个底朝天，也没找到自己想要的图片。\n\n前阵子听《安和桥》比较多，但我知道我想找的桥不是安和桥，而是在什刹海，地铁站出来不远的那座桥。  --万宁桥。\n\n这桥我走过两次，每次都是早上7、8点见面，傍晚5、6点告别。\n\n出现在我脑海里的桥，就是它。\n\n我又把必应、谷歌、百度翻了个底朝天，不出意料还是选不到自己满意的图。\n\n我想，既然别人的图不能满足我，就以后找个机会自己去拍吧。\n\n(编辑于 2020-02-02)\n\n#### 直到刚刚\n\ngithub 推荐了一个 leetcode 的项目，翻看到作者 <a href=\"https://github.com/azl397985856\" target=\"_blank\">@lucifer</a> 文档中有这样一句话：\n\n> 前几天，去了一趟山城重庆，在那里遇到了最美的人和最漂亮的风景。\n\n还有一些作者在当地拍的照片：重庆的楼宇、夜景、与立交桥。\n\n这些，是身临其境的照片。\n\n点进作者的主页，被其专业技能的深度和广度震撼到。\n\n我会跟着他学习很多。\n\n我也会在疫情结束后的某个傍晚，拍一张属于我的万宁桥。\n\n(编辑于 2020-02-02)"},"1007":{"id":1007,"title":"Javascript: call, apply, bind 与 new","author":"庄天宇","timestamp":1580998052507,"markdownString":"## Javascript: call, apply, bind 与 new\n\n庄天宇 2020-02-06\n\n### 2 年前\n\n2 年前，在梦哥的代码中，看到这样一个写法：\n\n```\nconst nodeList = document.querySelectorAll('div')\n\nArray.prototype.map.call(nodeList, () => {})\n```\n\n(下文以<code>call</code>为例)\n\n### call\n\n> <code>call()</code>方法使用一个指定的<code>this</code>值和单独给出的一个或多个参数来调用一个函数。\n\n- 语法：<code>function.call(thisArg, arg1, arg2, ...)</code>\n\n- 参数：<code>thisArg</code>、<code>arg1, arg2, ...</code>\n\n    - <code>thisArg</code>：可选的。在<code>function</code>函数运行时使用的<code>this</code>值。请注意，<code>this</code>可能不是该方法看到的实际值：如果这个函数处于非严格模式下，则指定为<code>null</code>或<code>undefined</code>时会自动替换为指向全局对象，原始值会被包装。\n\n    - <code>arg1, arg2, ...</code>：指定的参数列表。\n\n- 返回值：使用调用者提供的<code>this</code>值和参数调用该函数的返回值。若该方法没有返回值，则返回<code>undefined</code>。\n\n(本段引用自 <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call\" target=\"_blank\">mdn--call</a> ⬆️)\n\n### 关于 2 年前\n\n2 年前的<code>nodeList</code>是类数组，不具备数组的<code>map</code>方法。\n\n如果需要使用此方法，可以通过<code>Array.from(nodeList)</code>将类数组转化为数组，但这不是我们讨论的。\n\n参考<code>call</code>方法的定义，我们可以调用<code>Array.prototype.map</code>方法：\n\n通过指定的<code>this</code> (即<code>nodeList</code>)，与调用时的参数 (即<code>map</code>方法需要的<code>Function</code>函数)。\n\n### new\n\n> <code>new</code>运算符创建一个用户定义的对象类型的实例或具有构造函数的内置对象的实例。\n\n<code>new</code>关键字会进行如下的操作：\n\n1. 引擎内部新建一个空对象 (即<code>{}</code>).\n\n2. 将这个空对象的<code>__proto__</code>指向构造函数的<code>prototype</code>.\n\n3. 调用构造函数，去填充创建的空对象 (如果有必要)，并将<code>this</code>指向该对象。\n\n4. 如果该函数没有返回对象，则返回<code>this</code>.\n\n如何实现一个<code>new</code>关键字？\n\n```\nfunction myNew (constructor, ...args) {\n  const obj = {}\n  obj.__proto__ = constructor.prototype\n  const ret = constructor.call(obj, ...args)\n  return ret instanceof Object ? ret : obj\n}\n```\n\n(本段引用自 <a href=\"https://lucifer.ren/fe-interview/#/topics/js/prototype?id=new\" target=\"_blank\">@lucifer--fe-interview--new</a> ⬆️)\n\n### 参考\n\n- <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call\" target=\"_blank\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call</a>\n\n- <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply\" target=\"_blank\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply</a>\n\n- <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind\" target=\"_blank\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind</a>\n\n- <a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new\" target=\"_blank\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new</a>\n\n- <a href=\"https://lucifer.ren/fe-interview/#/topics/js/prototype?id=new\" target=\"_blank\">https://lucifer.ren/fe-interview/#/topics/js/prototype?id=new</a>"},"1008":{"id":1008,"title":"热风·随感录四十一 (转载)","author":"庄天宇","timestamp":1581088380762,"markdownString":"### 热风·随感录四十一 (转载)\n\n鲁迅 1925年编定\n\n愿中国青年都摆脱冷气，只是向上走，不必听自暴自弃者流的话。\n\n能做事的做事，能发声的发声。\n\n有一分热，发一分光，就令萤火一般，也可以在黑暗里发一点光，不必等候炬火。\n\n此后如竟没有炬火：我便是唯一的光。"},"1009":{"id":1009,"title":"陈鸿宇的理想三旬，我的理想三月","author":"庄天宇","timestamp":1581220827821,"markdownString":"### 陈鸿宇的理想三旬，我的理想三月\n\n庄天宇 2020-02-09\n\n#### 2019 年春天的某天早上\n\n夏祥云骑着 8 公里的小蓝车，从家里骑到公司。摘下耳机，“这首歌我听了一路，真好听”。\n\n那时候天还很冷。\n\n#### 2017 年年底\n\n我开始玩绝地求生，也从那时开始看 xdd 的直播。直播间总会放这首歌，便渐渐爱上。\n\n#### 2018 年 3 月、小雨\n\n大概是某个周六，接近中午 11 点。天很阴，下着淅淅沥沥的小雨，没带伞。\n\n我在等 5 块钱一份的炸鸡块，不知道锅里的油用了多久。\n\n从租的屋子到这家店，要过 1 个路口，走 2 段胡同，一共 500 米。\n\n那天的路特别泥泞，想起雨水落在后背的感觉，想起几天前地铁 5 号线回家路上。\n\n#### 2018 年 3 月、小雨的前几天\n\n从大屯路东上的地铁，回天通苑。我插着网易云听歌，身上夹着半干不湿的雨伞。\n\n站在车厢中央，地铁往北边开。雨水落在车窗上，却一直往南方落。\n\n> 雨后有车驶来，驶过暮色苍白。旧铁皮往南开，恋人已不在。\n\n#### 2020 年 3 月\n\n眼看就快到了，今年的 3 月，会像歌里写的那样吗。"},"1010":{"id":1010,"title":"野馄饨与很久以前","author":"庄天宇","timestamp":1582040235041,"markdownString":"### 野馄饨与很久以前\n\n庄天宇 2019-02-26\n\n#### 开场\n\n“震哥你一定知道野馄饨这个词儿”。\n\n“那肯定知道啊，上学那会儿总去吃”。\n\n--故事这样开场。\n\n#### 野馄饨\n\n小震每年不管是上班还是出去玩，都要从北京路过几次，今年也不例外。上午收到微信，傍晚志哥我们仨就坐在西站的饭店了。刚刚的对话是上半场要结束时，提到了野馄饨。\n\n我第一次听说野馄饨，是从响哥那里：\n\n“野馄饨就是路边摊儿，青岛那边的叫法。以前和朋友出去玩，一帮人迷迷糊糊地喝到大半夜，找个路边摊整点儿烧烤，来一碗热乎的野馄饨”。\n\n这番话让我想起曾生活过四年的大连，也是沿海城市，也曾是每个人经历过的地方。\n\n我爱大连，那种步行半个小时，就能到达海边的感觉。无论是春天的中午海边的风，还是秋天退潮时的夕阳，或是下雪但是海水从不结冰的寒冬，都很让我流连忘返。流连每个经历过的瞬间，忘返此时此刻忙碌的生活与工作，忘返和小震志哥的上半场。\n\n上半场即将结束，小震还没抢到回包头的车票，三个人也只喝了一斤“牛二”意犹未尽。翻了一眼附近的地儿，“去很久以前吧，那儿不错”，志哥说。\n\n五分钟后，到了很久以前，--很久以前羊肉串。\n\n#### 很久以前\n\n点了一份羊肉串，宣传的点是呼伦贝尔羊肉。又点了多春鱼、鱼豆腐、老醋花生。\n\n对事物的印象积累是循序渐进的过程，我也终于在很久以前体验到仿佛时间真的过得很慢。这里不是炭火，却丝毫没有减少温暖的氛围。从我看到这里的烤架是两侧有链条，可以带动含齿轮的扦子，使得肉串以旋转的姿态均匀地烤熟，还能在旋转的过程中看到烤出来的羊油坠落到烤架底部的水上。从我看到这里的餐盘是分成了几部分，便于盛放分开装的干料包与辣椒面。从我看到上桌时，送给我们的那罐呼伦贝尔空气。从我吃到 5 分钟后烤好的第一口我本没有寄予厚望的呼伦贝尔羊肉…\n\n我崩溃了，这次是真的。\n\n我没有回到呼伦贝尔草原，我只是回到了家里，回到了小区车库的门外。老庄坐在板凳上，用纸壳子给刚点着的烤架煽火，火越烧越旺。旁边的桌上放着的是串好的肉串儿，和妈洗过的蔬菜、备好的孜然辣椒面、和一切能用到的食材辅料。第一把串儿烤好，老庄放到盘子里让我们先端过去吃。五分钟后第二把烤好，老庄留了两串儿放在烤架边上没有碳火的地方，吃了一口串儿，咕嘟咕嘟喝下去半瓶啤酒，顺手拿起挂在脖子上的毛巾，擦了擦满头的汗。他就这样，从不吃烤出来的第一把。\n\n“您好，这是您点的多春鱼和鱼豆腐，烤五分钟就能吃了~”\n\n#### 后来\n\n后来小震抢到了票，我们也在十二点结束下半场，各自回家。"},"1011":{"id":1011,"title":"少年，后会有期","author":"庄天宇","timestamp":1589816418054,"markdownString":"### 少年，后会有期\n\n庄天宇 2020-05-18\n\n#### 0.开场\n\n“你室友都回来了吗？” \n\n“他们都退租了，下个月我也要走了。”\n\n“你要搬家了吗？”\n\n“我要回家准备考研了。”\n\n午饭时间，我们坐在中关村的一家餐厅。\n\n小半年没见，再次见面却是告别。\n\n北京连续的阴天终于放晴，今天格外的热。\n\n#### 1.梦想\n\n你总会以“少年”作为微信打招呼的开始，但明明你才是最有少年气息的。\n\n毕业后先去北京，又辗转上海，而后回到北京。\n\n从 python 写到前端，又从前端搞到服务器，真有你的。\n\n当你说出回家考研的那一刻我是震惊的，而后我又在你坚定的眼神里看到了些什么。\n\n做开发这个行业饿不死，但大部分时候不会那么快乐。\n\n即使我知道你我是很热爱这件事的。\n\n可谁都不愿拘泥于此。\n\n#### 2.雨夜\n\n我刚换工作到中关村的某个傍晚 9 点多，小雨。\n\n微信叫了工作很忙的你去楼下吃麦当劳，果真你还在公司。\n\n我们坐在靠马路侧的窗边，看着雨水淋着匆忙的中关村，聊着彼此的工作。\n\n我从没带着电脑去过星巴克，但我猜大概就是这种感觉吧。\n\n后来我淋着雨赶上最后一班地铁，你回公司继续加班到深夜。\n\n#### 3.续\n\n“希望能在明年你回北京复试的时候见到你。”\n\n“到时我们再去吃很久以前。”\n\n“干杯！”\n"},"1012":{"id":1012,"title":"车","author":"庄天宇","timestamp":1590505868475,"markdownString":"### 车\n\n庄天宇 2020-05-26\n\n#### 车手呼啸而过\n\n走在夜幕下的小路上，树叶从路的两旁坠下。\n\n骑着电动车的车手呼啸而过。\n\n“你说他骑车时快乐吗？”\n\n“快不快乐不知道，但他骑得很快。”\n\n“会有人天生就想成为一名骑手吗？”\n\n“可能吧，可能和他当初想的赛道不一样吧。”\n\n#### 旧皮卡\n\n滴滴师傅小心翼翼地开着车。\n\n走在我回家的坑坑洼洼的路上。\n\n不到 1 公里的路，开了得有 10 分钟。\n\n此刻，我无比地想念我爸的那辆旧皮卡。\n\n#### 地铁\n\n站在地铁的第二节车厢，我是除了司机外最接近目的地的人。\n\n我趴在驾驶室的后窗上，用手挡住车厢的灯光，好能看清地铁前方的景色。\n\n前方是黑色的，没有灯光的，不知何时会转弯的路。\n\n司机回头看了我一次，他以为我在看他。\n\n我也以为我在看远方。\n\n#### 夜\n\n车手呼啸而过。"},"1013":{"id":1013,"title":"理发师","author":"庄天宇","timestamp":1594998755703,"markdownString":"### 理发师\n\n庄天宇 2020-07-17\n\n#### 0.\n\n每个狙击手都有自己熟悉的密位，每个理发师都有自己熟悉的推刀。\n\n#### 1.\n\n晚饭过后，几人不愿回家，在店里坐了好久。下雨的周五傍晚，很难不享受这样惬意的时光。\n\n蹭着宇哥的会员卡，跟他一起来到饭店旁边的理发店，我很少来这家。\n\n随机的时间，随机的理发师，但我没有选择随机的价位，还是最基础的那款。\n\n洗过头的我坐在椅子上，理发师把幕布系在我的前方。\n\n侧面后面推短，上面剪一点，左边梳。我对每个理发师都这样说。\n\n坐下时，我的头发还没擦干。\n\n理发师站在我的后方，用梳子把我的头发梳来梳去，我不知他在想什么，他不知我在想什么。\n\n没擦干的水滴在我的脸上。\n\n半晌，从头顶开始，慢慢地拾起一撮儿头发，轻轻地剪了几下。\n\n这样的状态持续了几分钟，他仿佛还在犹豫不决。\n\n像在确定作品的轮廓。\n\n#### 2.\n\n他还在梳我的头发，终于在第十次掠过头顶时，找到合适的角度，拿起别在手腕处的夹子夹了上去。\n\n作业是从左侧鬓角开始的，轻松几下确定了基本的角度，隔在我和推刀之间的梳子很快就退了场。\n\n推刀也从粗挡调成了细挡，以我的耳根为中心，自信地向上推，向上推。\n\n每次回到我的耳根，我都在期待半秒后，推刀与我鬓角摩擦的快感。\n\n伴随着推刀划断头发的咔嚓声，伴随着推刀的机械振动。\n\n这快感不常有，难得遇到这么自信的理发师了。\n\n#### 3.\n\n不久右侧的鬓角也处理完毕，理发师拉过一旁的凳子，坐在我的身后继续剪。\n\n从后脖颈的发际线开始，粗挡的推刀慢慢地向上推，挡位很粗但手法过细。\n\n还是后脖颈的发际线，发际线的尾部，不久又被细挡的推刀过了几遍，每次与脖颈接触，都是我期待的快感。\n\n脖颈的修整最终与鬓角相连，如果此刻我能看的清镜子，我就能看到理发师满意的神情。\n\n推刀被调到了更细的挡位。\n\n理发师握着锋利的推刀，从右侧鬓角向后掠过脖颈的发际线，回到左侧鬓角。节奏平滑却棱角分明。\n\n我真担心他锋利的推刀划破我的皮肤。\n\n#### -1.\n\n我没要到他的名片。他叫东子，是店里唯一戴眼镜的人。\n\n今夜，他将拿着最锋利的剑，走进雨中，刺破下一个周一。"},"1014":{"id":1014,"title":"网站优化记录","author":"庄天宇","timestamp":1595504756284,"markdownString":"## 网站优化记录\n\n庄天宇 2020-07-23\n\n### v2.0.4\n\n- 网站支持了 `https` 协议。\n\n### v2.0.3\n\n- 网站服务迁移至腾讯云。\n\n### v2.0.2\n\n- 媒体查询了 `apple` 的深色模式，进行整站风格适配。\n\n### v2.0.1\n\n- 全局移除了 antd，自己实现了所需的组件等。\n- 组件地址：<a href=\"https://github.com/zhuangTianYu/luck-2020-react/tree/master/src/components\" target=\"_blank\">github: components</a>\n- 组件预览：<a href=\"http://zhuangtianyu.com/components\" target=\"_blank\">组件预览</a>\n- 优化前:\n    - 资源加载数: 5\n    - 资源消耗流量: 930kB\n    - 加载总耗时: 7.37s\n- 优化后:\n    - 资源加载数: 4\n    - 资源消耗流量: 294kB\n    - 加载总耗时: 1.27s\n- 通过一层 map 返回过滤好的文档列表数据 (后端)。\n\n### v2.0.0\n\n- 引入了 antd 作为 ui 框架。\n- 文章模块基于 json 文件实现。\n- 引入了 `antd`，即使做了官方推荐的 tree shaking，整站打包后依然有 930kB.\n- 由于服务器只有 1M 的带宽，实际下载速度为 120kB/s，需要加载时间为 6 秒多。\n- 文档列表接口中的每个 `item`，返回了无用的文档详情字段。"},"1015":{"id":1015,"title":"CentOS 中 nginx 配置及注意事项","author":"庄天宇","timestamp":1604932887582,"markdownString":"### CentOS 中 nginx 配置及注意事项\n\n庄天宇 2020-11-09\n\n#### 背景\n\n阿里云服务到期，将网站迁移至腾讯云。\n\n需要逐步配置腾讯云服务器环境，从 nginx 上手。\n\n#### 安装 nginx\n\n```\nyum install nginx\n```\n\n#### 配置 nginx\n\n```\nvim /etc/nginx/nginx.conf\n```\n\n注意以下几点：\n\n1. 修改 `80` 端口下 `/` 的 `root` 入口为实际的 `index.html` 入口。\n2. 如上述入口由 `/etc` 目录变更为 `/root` 目录，需调整 `user nginx` 为 `user root`.\n3. 需配置 `try_files $uri $uri/ /index.html;` 否则页面刷新会返回 `404` 页面。\n\n部分代码片段：\n\n```\nlocation / {\n  root   /root/frontend/blog;\n  index  index.html index.htm;\n  try_files $uri $uri/ /index.html;\n}\n```\n\n#### 验证配置文件正确性\n\n```\nnginx -t\n```\n\n配置正确会输出如下信息：\n\n```\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n#### 执行 reload 指令\n\n```\nnginx -s reload\n```\n\n有如下报错：\n\n```\nnginx: [error] invalid PID number \"\" in \"/run/nginx.pid\"\n```\n\n#### 处理报错\n\n需要声明配置文件路径，即 `nginx -t` 指令返回的路径：\n\n```\nnginx -c /etc/nginx/nginx.conf\n```\n\n再次执行重启指令：\n\n```\nnginx -s reload\n```\n\n即可访问到新的 `index.html` 入口文件。\n\n#### 参考文档\n\n1. <a href=\"https://zhuanlan.zhihu.com/p/77670912\" target=\"_blank\">CentOS（7.6）基本操作与Nginx配置</a>\n2. <a href=\"https://blog.csdn.net/vanilla_he/article/details/79205091\" target=\"_blank\">nginx 配置 403 forbidden 报错</a>\n3. <a href=\"https://www.nginx.com/\" target=\"_blank\">nginx 官网</a>\n"},"1016":{"id":1016,"title":"这二十多年，你披荆斩棘","author":"庄天宇","timestamp":1605976890697,"markdownString":"### 这二十多年，你披荆斩棘\n\n庄天宇 2020-11-22\n\n#### 我\n\n我感觉生活还不错。\n\n#### 画\n\n毛线画是小学一年级时的手工作业。\n\n要先在纸板上画出轮廓，再用胶水把揪成絮状的彩色毛线粘上去。\n\n那天我直到临睡前，才想起还有这个作业没做。着急地快要哭了出来。\n\n没事儿，睡觉吧，我帮你做。\n\n清晨我突然醒来，惦记着我的毛线画，跑到客厅。\n\n还亮着的台灯下，你粘着最后几缕毛线。\n\n那是一只黄色绒的小鸭子。\n\n#### 面\n\n迎宾广场对面的炒面店，坐在靠墙那排中间的位置。\n\n初中的我爱吃鱼香炒面，到现在我也爱吃。\n\n可是那天我点了西红柿鸡蛋炒面。\n\n我以为饭店的西红柿鸡蛋也像你做的那样好吃。\n\n这次你点了鱼香炒面。\n\n西红柿炒面上来了，我吃了几口却不是喜欢的滋味。\n\n初中孩子还是藏不住简单的情绪。\n\n是你想吃的那个味儿吗？我尝尝。还挺好吃的，咱俩换着吃吧。\n\n现在想起，那是我吃过最难吃的西红柿鸡蛋。\n\n#### 海\n\n你拿着那部用了多年的诺基亚，给大一的我和校门拍了张照。\n\n新生报到匆匆忙忙，我在你离开的第二天下午，就和室友走路去了海边。\n\n那是我第一次看到海，也是我第一次离开你。后面多年我们聚少离多。\n\n你爱旅行，我真该陪你去海边走走的。\n\n#### 窗\n\n小学二年级时，我隔着学校陈列室的玻璃窗，看到了那只小黄鸭。\n\n时光列车从窗口驶过，我还会做当初的种种选择，你依然会站在我这一侧。\n\n谢谢你，生日快乐。"},"1017":{"id":1017,"title":"我们应该走在海边的","author":"庄天宇","timestamp":1599818461808,"markdownString":"### 我们应该走在海边的\n\n庄天宇 2020-09-11\n\n#### 长夜看海\n\n<audio src=\"https://music.163.com/song/media/outer/url?id=1468957506.mp3\" controls></audio>\n\n#### 周五\n\n眼看着到周末，却没有前几天那么快乐了。\n\n没盼头了，后天就是周日了。朋友说，他讨厌周五。\n\n有一些日子里，我们不用在意今天是周几。\n\n#### 冬天\n\n雪下的很大，挡住睫毛，遮住了视线。\n\n从黄昏下到傍晚越下越厚，还是没能藏住心中的悸动，去海边。\n\n出租车停靠在海边两个路口的位置，外面的世界是白色的。\n\n雪从天空飘下，划过橘色的路灯，掠过朦胧的哈气、温暖的领口，融在夜色中。\n\n沙滩是白色的，海水是黑色的，夜空是蓝色的，我该是什么颜色。\n\n就沿着海边走，雪和沙在演奏，风和海浪在歌唱。\n\n#### 傍晚\n\n没有清晨和上午，醒来时就是中午了。\n\n下午很热，球场上充满了汗水和冲突。\n\n傍晚很凉爽，仿佛海边延伸了十几公里一样。\n\n透过高高的树丛，深色的夜晚就要铺满了天空。\n\n门口小摊的灯也已经点亮，空气中弥漫着令人愉悦的味道。\n\n几小时后从头顶泼下的一盆凉水，是向今天告别，也是向明天的问好。\n\n#### 潮湿\n\n无数个潮湿的夜晚我在路上骑行，空气润湿我的喉咙。\n\n#### 飞机\n\n那是一次清晨出发、中午到达、傍晚就返程的旅行。\n\n我的疲惫在落地的那一刻被海风吹醒。\n\n走过曾经的路，去曾经的屋子问候新的租客。\n\n再点上两盘辣炒蚬子，喝着在北京时喝的一样的酒。\n\n认真地和熟悉的彼此，聊着现在的工作和生活。\n\n错过返程的火车，错过本就错过的那些时刻。\n\n#### 海边\n\n最后我爱上了周一。\n\n如果终究要失去，那么不如早点遇见。\n\n我终于明白，我爱的不是周末，而是期盼周末的那些时刻。\n\n我们不该坐在办公室的，我们应该走在海边的。\n"},"1018":{"id":1018,"title":"那个伫立在面包店门口的女人","author":"庄天宇","timestamp":1600538166058,"markdownString":"### 那个伫立在面包店门口的女人\n\n庄天宇 2020-09-20\n\n去年经常在海淀黄庄吃饭，途径地铁站的路上，会路过一个面包店。\n\n每每黄昏，总有个上了年纪的阿姨，挎着深色的布袋站在那里。\n\n她的眼神好像望向远方深不见底，却又浑浊疲惫暗淡无光。\n\n去吃饭时是夏日的六七点钟，饭后走回地铁是秋风的九点几刻。\n\n她身边的行人幻灯片似地流逝、穿梭。\n\n她在期待什么，还是在等待哪个失去的人。\n\n地铁驶过海淀黄庄无数次，她等待的人会载着满怀的丰收回到她的身旁。"},"1019":{"id":1019,"title":"SSL 证书申请及 nginx 配置","author":"庄天宇","timestamp":1609840808258,"markdownString":"## SSL 证书申请及 nginx 配置\n\n庄天宇 2021-01-05\n\n### 背景\n\nSSL 是一种服务器证书，用于为网站 / 服务器添加 `https` 协议支持。\n\n虽然 `https` 看起来并没有那么大的用处，但是：\n\n-  微信小程序只支持调用 `https` 的服务。\n-  访问网站时浏览器不再会在地址栏提示“不安全”的字样。\n\n这么看起来还比较 😎 的。\n\n### 获取证书\n\n各服务器厂商 (阿里、腾讯、华为) 都提供了免费的 **域名型免费证书(DV)**，优点是免费且颁发速度快。\n\n最后得到如下两个文件用于 `nginx` 配置：\n\n-  1\\_yourwebsite.com_bundle.crt\n-  2_yoursebsite.com.key\n\n将上述两个文件放置在 `nginx` 目录下。\n\n### nginx 配置\n\n首先确保服务器的安全组配置包含了 443 端口。\n\n#### 修改 nginx 配置文件 443 端口配置:\n\n```\n# 原有 80 端口下方，配置 443 端口\n\nserver {\n  listen 443 ssl;\n  server_name zhuangtianyu.com;\n\n  ssl_certificate 1_yourwebsite.com_bundle.crt;\n  ssl_certificate_key 2_yourwebsite.com.key;\n  ssl_session_timeout 5m;\n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\n  ssl_prefer_server_ciphers on;\n\n  location / {\n    root /root/frontend/blog;\n    index  index.html index.htm;\n    try_files $uri $uri/ /index.html;\n  }\n\n  location /image/ {\n    root /root/;\n    autoindex on;\n  }\n\n  location /api/ {\n    proxy_pass http://127.0.0.1:1995;\n  }\n}\n```\n\n配置说明：\n\n-  `ssl_certificate` 证书文件名称。\n-  `ssl_certificate_key` 私钥文件名称。\n-  `location /` 用于查找网站入口 `index.html` 文件。\n-  `location /image/` 用于查找网站图片目录资源。\n-  `location /api` 用于判断如果是接口请求，直接重定向到 `1995` 端口。\n\n#### 注意:\n\n```\nhttps://some-web.com:8000/api/some-api\n```\n\n⬆️ 此类协议为 `https` 且后面带有其它端口号的服务，是不可访问的。\n\n因此在 `nginx` 中对 `/api` 开头的请求，做了一次重定向到原 `1995` 端口服务。\n\n\n#### 原 80 端口添加如下配置:\n\n```\nreturn 301 https://$host$request_uri;\n```\n\n保证所有请求都重定向到 `https` 服务。\n\n而后验证 `nginx` 配置正确、并重启服务:\n\n```\nnginx -t\nnginx -s reload\n```\n\n至此 `nginx` 已经关联相关证书配置完毕，可通过 `http / https` 协议访问网站。\n\n### 参考文档\n\n- [腾讯云：SSL 证书申请](https://buy.cloud.tencent.com/ssl?fromSource=ssl)\n- [腾讯云：Nginx 服务器证书安装](https://cloud.tencent.com/document/product/400/35244)\n"},"1020":{"id":1020,"title":"写代码的本质是得寸进尺","author":"庄天宇","timestamp":1610517083807,"markdownString":"### 写代码的本质是得寸进尺\n\n庄天宇 2021-01-13\n\n> 得寸进尺：指贪心不满足，有了小的，又要大的。\n\n上一份工作的晚饭时间，王哥在食堂说出了令我难忘的一个真理：\n\n“当我得到一个需求时，我想把它设计的高大上一点。”\n\n“后来发现需求有点难，不如先写出来再说。”\n\n“最后发现 tm 根本写不出来！”\n\n这是一个不断让步的过程。\n\n到最后，几股思路在脑袋里相互干扰，互相纠缠。\n\n直到不得不停下思考。\n\n也许这个过程会很长，短则几小时，长则三五天。\n\n每天过得都很快，每天仿佛都没有什么进展，每天都是乱七八糟。\n\n忽然转天的某个瞬间，有了头绪。\n\n一旦有了头绪，思路就顺着键盘蔓延开来，直到完成。\n\n而后看着完成功能的代码，又开始考虑更好的抽象。\n\n把以完成为目标时写下的各处怪异代码干掉，不用担心 code review 时的异议。\n\n把代码块重新组织，变量名函数名起的更顺眼。\n\n最后满意地写上 commit log 才算完毕。\n\n真是舒服。\n\n🤭\n"},"1021":{"id":1021,"title":"如何优雅地消除代码中的魔法数字？","author":"庄天宇","timestamp":1612461964853,"markdownString":"## 如何优雅地消除代码中的魔法数字？\n\n庄天宇 2021-02-05\n\n### 什么是魔法数字？\n\n假设我们有以下业务逻辑：\n\n- 订单未支付，订单状态为 1\n- 订单已支付，订单状态为 2\n- 订单已发货，订单状态为 3\n- 订单已收货，订单状态为 4\n\n很容易写出如下代码片段：\n\n```\nconst getOptionGroup= orderStatus => (\n  <div className=\"option-group\">\n    {orderStatus === 1 && <button onClick={handlePay}>去支付</button>}\n    {orderStatus === 2 && <button onClick={handleRemind}>提醒发货</button>}\n    {orderStatus === 3 && <button onClick={handleCheckExpress}>查看物流</button>}\n    {orderStatus === 4 && <button onClick={handleApplyAfterSale}>申请售后</button>}\n  </div>\n);\n```\n\n上文的 1、2、3、4，即为魔法数字。\n\n如果只一处代码这样表示，那根据上下文倒也能猜测出大致的含义。\n\n但如果是逻辑复杂、篇幅较长的业务代码，即使配合着 1、2、3、4 的注释看，也会让可读性降低。\n\n我们可以尝试用**「语义化枚举」**进行优化。\n\n### 通过「语义化枚举」进行优化\n\n对魔法数字 1、2、3、4 进行整理：\n\n```\nconst ORDER_STATUS_MAP = {\n  unpaid: 1,    // 未支付\n  paid: 2,      // 已支付\n  sendOut: 3,   // 已发货\n  signedIn: 4,  // 已收货\n};\n```\n\n这样我们获取按钮的函数就可表示为：\n\n```\nimport { ORDER_STATUS_MAP  } from '@constant/order';\n\nconst getOptionGroup= orderStatus => (\n  <div className=\"option-group\">\n    {orderStatus === ORDER_STATUS_MAP.unpaid && <button onClick={handlePay}>去支付</button>}\n    {orderStatus === ORDER_STATUS_MAP.paid && <button onClick={handleRemind}>提醒发货</button>}\n    {orderStatus === ORDER_STATUS_MAP.sendOut && <button onClick={handleCheckExpress}>查看物流</button>}\n    {orderStatus === ORDER_STATUS_MAP.signedIn && <button onClick={handleApplyAfterSale}>申请售后</button>}\n  </div>\n);\n```\n\n由于 JSX 中渲染逻辑相关的表达式过多，可以将按钮的多种状态整理为 map：\n\n```\nimport { ORDER_STATUS_MAP  } from '@constant/order';\n\nconst ORDER_STATUS_BUTTON_MAP = {\n  unpaid: <button onClick={handlePay}>去支付</button>,\n  paid: <button onClick={handleRemind}>提醒发货</button>,\n  sendOut: <button onClick={handleCheckExpress}>查看物流</button>,\n  signedIn: <button onClick={handleApplyAfterSale}>申请售后</button>,\n};\n\nconst getOptionGroup= orderStatus => (\n  <div className=\"option-group\">\n    {ORDER_STATUS_BUTTON_MAP[orderStatus]}\n  </div>\n);\n```\n\n**「语义化枚举」**同样适用于如下多对一的业务场景：\n\n```\nimport { ORDER_STATUS_MAP  } from '@constant/order';\n\nconst { unpaid, paid, sendOut, signedIn } = ORDER_STATUS_MAP;\n\nconst getAfterSalesOption = orderStatus => {\n  if ([unpaid, paid, sendOut].includes(orderStatus)) {\n    return <button>申请退款</button>;\n  }\n\n  if (orderStatus === signedIn) {\n    return <button>申请退货退款</button>;\n  }\n\n  return null;\n};\n\n```\n\n### 总结\n\n通过**「语义化枚举」**我们可以消除魔法数字。\n\n也可以省略魔法数字配套的注释：`// orderStatus: 1.未支付 2.已支付 3.已发货 4.已收货`\n\n同时也节约了逻辑调整的成本：\n\n假设日后逻辑变更，需调整「已收货」状态值为 5。\n\n就不用全局搜索关键字 5 再判断各处的 5 是否代表着状态值了。\n\n只需将 `ORDER_STATUS_MAP.signedIn` 调整为 5 即可。"},"1022":{"id":1022,"title":"关于开发 React 组件的一些建议","author":"庄天宇","timestamp":1615778340739,"markdownString":"# 关于开发 React 组件的一些建议\n\n庄天宇 2021-03-15\n\n## 1. 样式\n\n### 1.1 命名空间\n\n容器 (组件最外层元素) 应使用项目内唯一的 `className` 包裹。\n\n容器内元素，无论使用 BEM 命名，或其他命名规则，都要保证在组件 `className` 的命名空间下，否则会造成样式污染。\n\n```js\n.user-info__name {}               /* 👍 */\n\n.user-info .user-name {}          /* 👍 */\n\n.user-name {}                     /* 🚫 */\n```\n\n### 1.2 基本样式不可变\n\n存在一个 `<List />` 组件：\n\n在场景 1 下，该组件需要 `10px` 的下边距。\n\n在场景 2 下，该组件需要 `12px` 的下边距。\n\n应当在父组件内，对 `<List />` 组件定义下边距：\n\n**order.css**\n\n> 假设 **`<Order />`** 组件内引用了 **`<List />`** 组件。\n\n```css\n.order-list .list {\n  margin-bottom: 10px;            /* 👍 */\n}\n```\n\n而非为 `<List />` 声明一个 `marginBottom` 属性：\n\n**list.js**\n\n```js\nconst { marginBottom } = props;\n\nretrun (\n  <div\n    className=\"list\"\n    style={{ marginBottom }}      /* 🚫 */\n  />\n);\n```\n\n更不建议在 `<List />` 内定义属性 `type: 1、2、3、4` 来渲染不同的下边距。\n\n### 1.3 避免使用标签选择器\n\n对浏览器而言，`标签选择器` 的效率低于 `id选择器` 和 `类选择器`，但这不是主要原因。\n\n原因在于如果组件内元素均使用 `类选择器` 命名，那么在维护 `css` 时会很快找到对应元素，可读性很高。\n\n如果使用 `标签选择器` 命名，且后期迭代时需要添加 *同标签不同样式* 的节点，依旧要使用 `className` 作区分。\n\n并且从可读性来看，`标签选择器` 的可读性是远不如 `类选择器` 的。\n\n## 2. 逻辑\n\n### 2.1 确定受控类型\n\n应当在组件设计初期确定其受控类型。\n\n**受控组件**：\n\n组件状态通过 `props.value` 传入，组件需要更新时调用 `prpos.onChange` 通知父组件更新 `props.value`.\n\n即所有的状态、及状态变更都由使用者通过 `props` 定义，由使用者控制，为受控组件。\n\n例如一个受控的 `Switch` 组件：\n\n```\n<Switch checked={checked} onChange={handleChange} />\n```\n\n**非受控组件**：\n\n组件状态内部维护，仅根据 `props.defaultValue` 初始化一次。\n\n组件更新时修改自身 `state.value`，并调用 `props.onChange` 通知父组件状态进行了更新。\n\n即组件内部维护状态，`onChange` 仅用于向父组件通知自身发生了状态变更。\n\n例如一个非受控的 `Switch` 组件：\n\n```\n<Switch defaultChecked onChange={handleChange} />\n```\n\n**如何选择?**\n\n大多数情况下推荐编写受控组件，因为其逻辑处理更为清晰，所有数据变更由调用者控制。\n\n如下情况推荐编写非受控组件：\n\n- 所有数据变更由用户交互发生，不存在主动变更数据的场景，例如 `Tabs` 组件。\n- 只关注最后一刻的数据，不关心数据变更的具体过程，例如 `Form` 组件。\n\n值得注意的是，非受控组件在必要时也需要提供方法支持外部更新自身的状态：\n\n例如 `Form` 组件需要支持 `resetFields`、`validateFields` 等 `api` 供使用者调用。\n\n### 2.2 组件的通用性\n\n### 2.n 🚧👷‍♂️🏗"},"1023":{"id":1023,"title":"有了滑板鞋，天黑都不怕","author":"庄天宇","timestamp":1615955172000,"markdownString":"## 有了滑板鞋，天黑都不怕\n\n庄天宇 2021-03-17\n\n<style>\n  .audio {\n    margin-bottom: 16px;\n  }\n  .lrc {\n    color: #6a737d;\n    line-height: 26px;\n    margin-bottom: 16px;\n  }\n</style>\n\n> 约瑟翰·庞麦郎 - 我的滑板鞋.mp3\n\n<audio\n  class=\"audio\"\n  src=\"https://music.163.com/song/media/outer/url?id=28605055.mp3\"\n  controls\n></audio>\n\n> “2021年3月11日晚，庞麦郎经纪人发布视频透露，庞麦郎因为患有严重的精神分裂症，2021年初被强制送进精神病院。”\n\n我坐在二教阶梯教室靠中段的位置，桌面上摊开着一本单词书。炎热夏日的下午，自习室是没多少人的，我也不该属于这里。\n\n那天我第一次听到《我的滑板鞋》，歌手用质朴却卡不上拍子的音色唱着画面感十足的歌。\n\n<div class=\"lrc\">\n  <div>“在一个晚上，我的母亲问我，今天怎么不开心。”</div>\n  <div>“有了滑板鞋，天黑都不怕。”</div>\n  <div>“我给自己打着节拍，这是我生命中美好的时刻。”</div>\n</div>\n\n谁又何尝没有寻找过自己的那双滑板鞋呢。\n\n16 年的利拉德在 NBA 赛场上翻江倒海，他代言的 D Lillard 2 我也想整一双。\n\n但是淘宝京东的旗舰店都没有上架，不放心第三方店铺的我，抛弃了下午的物理实验，去寻找我的滑板鞋。\n\n逛完学校旁边的几个商场也没能找到，我肯定不能灰溜溜地回去。于是买了张轻轨票，坐上了开往市里的车。\n\n大连这么大，我总能找到它。\n\n兄弟给我发来微信，说物理实验他帮我签到了，我也在那时下了公交车，来到最繁华的商业区。\n\n瞄着百度地图上一个又一个 Adidas 店铺，我一定能找到。\n\n在高楼间穿梭，在室外炎热的空气与商场的冷气间游荡，我一定能找到。\n\n可惜的是说走就走的我，手机没有多少电量了，还没找到我的球鞋，我不能回去。\n\n我的包里有充电线，也是到了下午的四点钟，便找了家小吃，确保我能在这充电后，我点了一份套餐。\n\n夜幕降临，我带着 50% 电量的手机重新出发。\n\n大连可真大，我今天还能否找到它。\n\n又逛了一片的专卖店，甚至连折扣店我都逛了好几家。想想都有意思，新款的球鞋怎么会出现在折扣店呢。\n\n市里未果，我坐上公交车去了大连南站，那边还有个商场，找不到我就回家。\n\n到南站时，手机已经没电关机了。在商场关门前 30 分钟我跑进去找了一圈，没有的。\n\n想想都有意思，市中心都没有的鞋，怎么会出现在这么偏的商场呢。\n\n真正的夜晚在 9 点到来，又累又饿的我现在该寻找回去的方向了。\n\n沿着大致的方向走在公路上，路过的公交站我都看一眼途径路线，却没有一个熟悉的站点。\n\n翻了翻兜里还有 200 的现金，已经打算找个宾馆住下了。真亏啊，鞋没买到，还得搭进去 200。\n\n一辆中巴从身旁驶过，我看着电子屏上写的「开往开发区」的字样，发疯地追着这辆车奔跑。\n\n终于在一个路口后它停了下来，调整着呼吸挤上了车，人真多。\n\n没有找到球鞋，但好在找到了回家的方向。\n\n校门口打包了一份鸡丝豆芽盖饭，回到寝室在淘宝上一家还算可以的店铺下单了。\n\n这双鞋，就当是我自己找到的吧。"}}